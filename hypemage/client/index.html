<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Robot Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <h1>ü§ñ Multi-Robot Dashboard</h1>
            <div class="connection-badges">
                <span 
                    @click="manualReconnect('storm')" 
                    :class="['badge', 'badge-clickable', storm.connected ? 'connected' : 'disconnected']"
                    title="Click to reconnect">
                    Storm {{ storm.connected ? '‚úì' : '‚úó' }}
                </span>
                <span 
                    @click="manualReconnect('necron')" 
                    :class="['badge', 'badge-clickable', necron.connected ? 'connected' : 'disconnected']"
                    title="Click to reconnect">
                    Necron {{ necron.connected ? '‚úì' : '‚úó' }}
                </span>
            </div>
        </header>
        
        <!-- Notifications -->
        <div class="notifications-container">
            <transition-group name="notification">
                <div 
                    v-for="notif in notifications" 
                    :key="notif.id" 
                    :class="['notification', `notification-${notif.type}`]"
                    @click="dismissNotification(notif.id)">
                    <span class="notification-icon">
                        <span v-if="notif.type === 'success'">‚úì</span>
                        <span v-else-if="notif.type === 'error'">‚úó</span>
                        <span v-else>‚Ñπ</span>
                    </span>
                    <span class="notification-message">{{ notif.message }}</span>
                    <span class="notification-close">√ó</span>
                </div>
            </transition-group>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Both View -->
            <div v-if="currentView === 'both'" class="both-view">
                <div class="robot-column">
                    <h2 class="robot-title">‚ö° Storm</h2>
                    <div class="widgets-container">
                        <!-- Controls -->
                        <div v-if="storm.visibleWidgets.has('controls')" class="widget">
                            <h3>üéÆ Control</h3>
                            <div class="button-group">
                                <button @click="startScript('storm', 'scylla_debug')" :disabled="storm.status === 'running'" class="btn btn-primary">‚ñ∂Ô∏è Robot</button>
                                <button @click="stopRobot('storm')" :disabled="storm.status !== 'running'" class="btn btn-danger">‚èπÔ∏è Stop</button>
                            </div>
                            <div class="button-group">
                                <button @click="startScript('storm', 'camera_stream')" :disabled="storm.status === 'running'" class="btn btn-secondary">üì∑ Camera</button>
                                <button @click="startScript('storm', 'camera_debug')" :disabled="storm.status === 'running'" class="btn btn-secondary">üîç Debug</button>
                                <button @click="startScript('storm', 'camera_calibrate')" :disabled="storm.status === 'running'" class="btn btn-secondary">üé® Calibrate</button>
                            </div>
                            <div class="status-info">
                                <p><strong>Status:</strong> {{ storm.status }}</p>
                                <p><strong>PID:</strong> {{ storm.pid || '-' }}</p>
                            </div>
                        </div>
                        
                        <!-- Camera -->
                        <div v-if="storm.visibleWidgets.has('camera')" class="widget widget-resizable camera-widget">
                            <h3>üì∑ Camera</h3>
                            <img v-if="storm.status === 'running'" :src="`http://${ROBOT_CONFIG.storm.host}:${ROBOT_CONFIG.storm.debugPort}/stream`" alt="Camera feed">
                            <div v-else class="no-feed">Start camera to view feed</div>
                        </div>
                        
                        <!-- Camera Calibration -->
                        <div v-if="storm.visibleWidgets.has('calibration')" class="widget widget-wide calibration-widget">
                            <h3>üé® HSV Calibration</h3>
                            <div class="calibration-container">
                                <!-- Preview Images -->
                                <div class="calibration-previews">
                                    <div class="preview-item">
                                        <div class="preview-label">Original</div>
                                        <img v-if="storm.calibration.original" :src="storm.calibration.original" alt="Original">
                                        <div v-else class="no-feed">No feed</div>
                                    </div>
                                    <div class="preview-item">
                                        <div class="preview-label">Ball Mask</div>
                                        <img v-if="storm.calibration.ball_mask" :src="storm.calibration.ball_mask" alt="Ball mask">
                                        <div v-else class="no-feed">No mask</div>
                                    </div>
                                    <div class="preview-item">
                                        <div class="preview-label">Blue Goal Mask</div>
                                        <img v-if="storm.calibration.blue_mask" :src="storm.calibration.blue_mask" alt="Blue goal mask">
                                        <div v-else class="no-feed">No mask</div>
                                    </div>
                                    <div class="preview-item">
                                        <div class="preview-label">Yellow Goal Mask</div>
                                        <img v-if="storm.calibration.yellow_mask" :src="storm.calibration.yellow_mask" alt="Yellow goal mask">
                                        <div v-else class="no-feed">No mask</div>
                                    </div>
                                </div>
                                
                                <!-- HSV Sliders -->
                                <div class="calibration-sliders">
                                    <!-- Ball HSV -->
                                    <div class="slider-group">
                                        <h4>üèÄ Ball HSV Range</h4>
                                        <div class="slider-row">
                                            <label>H Min (0-180):</label>
                                            <input type="range" min="0" max="180" v-model.number="storm.calibration.ball.lower[0]" @input="updateHSV('storm', 'ball')">
                                            <span>{{ storm.calibration.ball.lower[0] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>S Min (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.ball.lower[1]" @input="updateHSV('storm', 'ball')">
                                            <span>{{ storm.calibration.ball.lower[1] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>V Min (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.ball.lower[2]" @input="updateHSV('storm', 'ball')">
                                            <span>{{ storm.calibration.ball.lower[2] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>H Max (0-180):</label>
                                            <input type="range" min="0" max="180" v-model.number="storm.calibration.ball.upper[0]" @input="updateHSV('storm', 'ball')">
                                            <span>{{ storm.calibration.ball.upper[0] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>S Max (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.ball.upper[1]" @input="updateHSV('storm', 'ball')">
                                            <span>{{ storm.calibration.ball.upper[1] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>V Max (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.ball.upper[2]" @input="updateHSV('storm', 'ball')">
                                            <span>{{ storm.calibration.ball.upper[2] }}</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Blue Goal HSV -->
                                    <div class="slider-group">
                                        <h4>üîµ Blue Goal HSV Range</h4>
                                        <div class="slider-row">
                                            <label>H Min (0-180):</label>
                                            <input type="range" min="0" max="180" v-model.number="storm.calibration.blue_goal.lower[0]" @input="updateHSV('storm', 'blue_goal')">
                                            <span>{{ storm.calibration.blue_goal.lower[0] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>S Min (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.blue_goal.lower[1]" @input="updateHSV('storm', 'blue_goal')">
                                            <span>{{ storm.calibration.blue_goal.lower[1] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>V Min (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.blue_goal.lower[2]" @input="updateHSV('storm', 'blue_goal')">
                                            <span>{{ storm.calibration.blue_goal.lower[2] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>H Max (0-180):</label>
                                            <input type="range" min="0" max="180" v-model.number="storm.calibration.blue_goal.upper[0]" @input="updateHSV('storm', 'blue_goal')">
                                            <span>{{ storm.calibration.blue_goal.upper[0] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>S Max (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.blue_goal.upper[1]" @input="updateHSV('storm', 'blue_goal')">
                                            <span>{{ storm.calibration.blue_goal.upper[1] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>V Max (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.blue_goal.upper[2]" @input="updateHSV('storm', 'blue_goal')">
                                            <span>{{ storm.calibration.blue_goal.upper[2] }}</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Yellow Goal HSV -->
                                    <div class="slider-group">
                                        <h4>üü° Yellow Goal HSV Range</h4>
                                        <div class="slider-row">
                                            <label>H Min (0-180):</label>
                                            <input type="range" min="0" max="180" v-model.number="storm.calibration.yellow_goal.lower[0]" @input="updateHSV('storm', 'yellow_goal')">
                                            <span>{{ storm.calibration.yellow_goal.lower[0] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>S Min (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.yellow_goal.lower[1]" @input="updateHSV('storm', 'yellow_goal')">
                                            <span>{{ storm.calibration.yellow_goal.lower[1] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>V Min (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.yellow_goal.lower[2]" @input="updateHSV('storm', 'yellow_goal')">
                                            <span>{{ storm.calibration.yellow_goal.lower[2] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>H Max (0-180):</label>
                                            <input type="range" min="0" max="180" v-model.number="storm.calibration.yellow_goal.upper[0]" @input="updateHSV('storm', 'yellow_goal')">
                                            <span>{{ storm.calibration.yellow_goal.upper[0] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>S Max (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.yellow_goal.upper[1]" @input="updateHSV('storm', 'yellow_goal')">
                                            <span>{{ storm.calibration.yellow_goal.upper[1] }}</span>
                                        </div>
                                        <div class="slider-row">
                                            <label>V Max (0-255):</label>
                                            <input type="range" min="0" max="255" v-model.number="storm.calibration.yellow_goal.upper[2]" @input="updateHSV('storm', 'yellow_goal')">
                                            <span>{{ storm.calibration.yellow_goal.upper[2] }}</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Save Button -->
                                    <div class="calibration-actions">
                                        <button @click="saveCalibration('storm')" class="btn btn-success">üíæ Save Calibration</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Motors -->
                        <div v-if="storm.visibleWidgets.has('motors')" class="widget">
                            <h3>‚öôÔ∏è Motors</h3>
                            <div class="motors-grid">
                                <div v-for="motorName in ['front_left', 'front_right', 'back_left', 'back_right', 'dribbler']" :key="motorName" class="motor-item">
                                    <div class="motor-label">{{ motorName.replace('_', ' ') }}</div>
                                    <div class="motor-bar">
                                        <div class="motor-fill" :style="{width: Math.abs(storm.motors.speeds[motorName]) + '%', backgroundColor: storm.motors.speeds[motorName] >= 0 ? '#00ff88' : '#ff4444'}"></div>
                                    </div>
                                    <div class="motor-value">{{ Math.round(storm.motors.speeds[motorName]) }}%</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Logs -->
                        <div v-if="storm.visibleWidgets.has('logs')" class="widget widget-resizable logs-widget">
                            <h3>üìù Logs</h3>
                            <div class="logs-container">
                                <div v-if="storm.logs.length === 0" class="no-logs">No logs yet...</div>
                                <div v-else class="log-entries">
                                    <div v-for="(log, i) in storm.logs" :key="i" class="log-entry">{{ log }}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Status -->
                        <div v-if="storm.visibleWidgets.has('status')" class="widget">
                            <h3>‚ÑπÔ∏è Status</h3>
                            <p><strong>Host:</strong> {{ storm.host }}</p>
                            <p><strong>Connected:</strong> {{ storm.connected ? 'Yes' : 'No' }}</p>
                        </div>
                    </div>
                </div>
                
                <div class="robot-column">
                    <h2 class="robot-title">üíÄ Necron</h2>
                    <div class="widgets-container">
                        <!-- Controls -->
                        <div v-if="necron.visibleWidgets.has('controls')" class="widget">
                            <h3>üéÆ Control</h3>
                            <div class="button-group">
                                <button @click="startScript('necron', 'scylla_debug')" :disabled="necron.status === 'running'" class="btn btn-primary">‚ñ∂Ô∏è Robot</button>
                                <button @click="stopRobot('necron')" :disabled="necron.status !== 'running'" class="btn btn-danger">‚èπÔ∏è Stop</button>
                            </div>
                            <div class="button-group">
                                <button @click="startScript('necron', 'camera_stream')" :disabled="necron.status === 'running'" class="btn btn-secondary">üì∑ Camera</button>
                                <button @click="startScript('necron', 'camera_debug')" :disabled="necron.status === 'running'" class="btn btn-secondary">üîç Debug</button>
                                <button @click="startScript('necron', 'camera_calibrate')" :disabled="necron.status === 'running'" class="btn btn-secondary">üé® Calibrate</button>
                            </div>
                            <div class="status-info">
                                <p><strong>Status:</strong> {{ necron.status }}</p>
                                <p><strong>PID:</strong> {{ necron.pid || '-' }}</p>
                            </div>
                        </div>
                        
                        <!-- Camera -->
                        <div v-if="necron.visibleWidgets.has('camera')" class="widget widget-resizable camera-widget">
                            <h3>üì∑ Camera</h3>
                            <img v-if="necron.status === 'running'" :src="`http://${ROBOT_CONFIG.necron.host}:${ROBOT_CONFIG.necron.debugPort}/stream`" alt="Camera feed">
                            <div v-else class="no-feed">Start camera to view feed</div>
                        </div>
                        
                        <!-- Motors -->
                        <div v-if="necron.visibleWidgets.has('motors')" class="widget">
                            <h3>‚öôÔ∏è Motors</h3>
                            <div class="motors-grid">
                                <div v-for="motorName in ['front_left', 'front_right', 'back_left', 'back_right', 'dribbler']" :key="motorName" class="motor-item">
                                    <div class="motor-label">{{ motorName.replace('_', ' ') }}</div>
                                    <div class="motor-bar">
                                        <div class="motor-fill" :style="{width: Math.abs(necron.motors.speeds[motorName]) + '%', backgroundColor: necron.motors.speeds[motorName] >= 0 ? '#00ff88' : '#ff4444'}"></div>
                                    </div>
                                    <div class="motor-value">{{ Math.round(necron.motors.speeds[motorName]) }}%</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Logs -->
                        <div v-if="necron.visibleWidgets.has('logs')" class="widget widget-resizable logs-widget">
                            <h3>üìù Logs</h3>
                            <div class="logs-container">
                                <div v-if="necron.logs.length === 0" class="no-logs">No logs yet...</div>
                                <div v-else class="log-entries">
                                    <div v-for="(log, i) in necron.logs" :key="i" class="log-entry">{{ log }}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Status -->
                        <div v-if="necron.visibleWidgets.has('status')" class="widget">
                            <h3>‚ÑπÔ∏è Status</h3>
                            <p><strong>Host:</strong> {{ necron.host }}</p>
                            <p><strong>Connected:</strong> {{ necron.connected ? 'Yes' : 'No' }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Storm Single View -->
            <div v-if="currentView === 'storm'" class="single-view">
                <h2 class="robot-title">‚ö° Storm - Detailed View</h2>
                <div class="widgets-container expanded">
                    <div v-if="storm.visibleWidgets.has('controls')" class="widget">
                        <h3>üéÆ Control</h3>
                        <div class="button-group">
                            <button @click="startRobotDebug('storm')" :disabled="storm.status === 'running'" class="btn btn-primary">‚ñ∂Ô∏è Debug</button>
                            <button @click="stopRobot('storm')" :disabled="storm.status !== 'running'" class="btn btn-danger">‚èπÔ∏è Stop</button>
                        </div>
                        <div class="status-info">
                            <p><strong>Status:</strong> {{ storm.status }}</p>
                            <p><strong>PID:</strong> {{ storm.pid || '-' }}</p>
                        </div>
                    </div>
                    <div v-if="storm.visibleWidgets.has('camera')" class="widget widget-resizable camera-widget">
                        <h3>üì∑ Camera <span v-if="storm.camera.fps">{{ storm.camera.fps }} FPS</span></h3>
                        <img v-if="storm.camera.frame" :src="storm.camera.frame" alt="Camera feed">
                        <div v-else class="no-feed">No camera feed</div>
                    </div>
                    <div v-if="storm.visibleWidgets.has('motors')" class="widget">
                        <h3>‚öôÔ∏è Motors</h3>
                        <div class="motors-grid">
                            <div v-for="motorName in ['front_left', 'front_right', 'back_left', 'back_right', 'dribbler']" :key="motorName" class="motor-item">
                                <div class="motor-label">{{ motorName.replace('_', ' ') }}</div>
                                <div class="motor-bar">
                                    <div class="motor-fill" :style="{width: Math.abs(storm.motors.speeds[motorName]) + '%', backgroundColor: storm.motors.speeds[motorName] >= 0 ? '#00ff88' : '#ff4444'}"></div>
                                </div>
                                <div class="motor-value">{{ Math.round(storm.motors.speeds[motorName]) }}%</div>
                            </div>
                        </div>
                    </div>
                    <div v-if="storm.visibleWidgets.has('logs')" class="widget widget-resizable logs-widget">
                        <h3>üìù Logs</h3>
                        <div class="logs-container">
                            <div v-if="storm.logs.length === 0" class="no-logs">No logs yet...</div>
                            <div v-else class="log-entries">
                                <div v-for="(log, i) in storm.logs" :key="i" class="log-entry">{{ log }}</div>
                            </div>
                        </div>
                    </div>
                    <div v-if="storm.visibleWidgets.has('status')" class="widget">
                        <h3>‚ÑπÔ∏è Status</h3>
                        <p><strong>Host:</strong> {{ storm.host }}</p>
                        <p><strong>Connected:</strong> {{ storm.connected ? 'Yes' : 'No' }}</p>
                    </div>
                </div>
            </div>

            <!-- Necron Single View -->
            <div v-if="currentView === 'necron'" class="single-view">
                <h2 class="robot-title">üíÄ Necron - Detailed View</h2>
                <div class="widgets-container expanded">
                    <div v-if="necron.visibleWidgets.has('controls')" class="widget">
                        <h3>üéÆ Control</h3>
                        <div class="button-group">
                            <button @click="startRobotDebug('necron')" :disabled="necron.status === 'running'" class="btn btn-primary">‚ñ∂Ô∏è Debug</button>
                            <button @click="stopRobot('necron')" :disabled="necron.status !== 'running'" class="btn btn-danger">‚èπÔ∏è Stop</button>
                        </div>
                        <div class="status-info">
                            <p><strong>Status:</strong> {{ necron.status }}</p>
                            <p><strong>PID:</strong> {{ necron.pid || '-' }}</p>
                        </div>
                    </div>
                    <div v-if="necron.visibleWidgets.has('camera')" class="widget widget-resizable camera-widget">
                        <h3>üì∑ Camera</h3>
                        <img v-if="necron.status === 'running'" :src="`http://${ROBOT_CONFIG.necron.host}:${ROBOT_CONFIG.necron.debugPort}/stream`" alt="Camera feed">
                        <div v-else class="no-feed">Start camera to view feed</div>
                    </div>
                    <div v-if="necron.visibleWidgets.has('motors')" class="widget">
                        <h3>‚öôÔ∏è Motors</h3>
                        <div class="motors-grid">
                            <div v-for="motorName in ['front_left', 'front_right', 'back_left', 'back_right', 'dribbler']" :key="motorName" class="motor-item">
                                <div class="motor-label">{{ motorName.replace('_', ' ') }}</div>
                                <div class="motor-bar">
                                    <div class="motor-fill" :style="{width: Math.abs(necron.motors.speeds[motorName]) + '%', backgroundColor: necron.motors.speeds[motorName] >= 0 ? '#00ff88' : '#ff4444'}"></div>
                                </div>
                                <div class="motor-value">{{ Math.round(necron.motors.speeds[motorName]) }}%</div>
                            </div>
                        </div>
                    </div>
                    <div v-if="necron.visibleWidgets.has('logs')" class="widget widget-resizable logs-widget">
                        <h3>üìù Logs</h3>
                        <div class="logs-container">
                            <div v-if="necron.logs.length === 0" class="no-logs">No logs yet...</div>
                            <div v-else class="log-entries">
                                <div v-for="(log, i) in necron.logs" :key="i" class="log-entry">{{ log }}</div>
                            </div>
                        </div>
                    </div>
                    <div v-if="necron.visibleWidgets.has('status')" class="widget">
                        <h3>‚ÑπÔ∏è Status</h3>
                        <p><strong>Host:</strong> {{ necron.host }}</p>
                        <p><strong>Connected:</strong> {{ necron.connected ? 'Yes' : 'No' }}</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="view-switcher">
                <button :class="['view-btn', {active: currentView === 'both'}]" @click="currentView = 'both'">Both</button>
                <button :class="['view-btn', {active: currentView === 'storm'}]" @click="currentView = 'storm'">Storm</button>
                <button :class="['view-btn', {active: currentView === 'necron'}]" @click="currentView = 'necron'">Necron</button>
            </div>
            <div class="widget-toggles">
                <span class="toggle-label">Widgets:</span>
                <button v-for="widget in availableWidgets" :key="widget.id" 
                        :class="['toggle-btn', {active: isWidgetVisible(currentView, widget.id)}]"
                        @click="toggleWidgetForCurrentView(widget.id)">
                    {{ widget.icon }} {{ widget.name }}
                </button>
            </div>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>